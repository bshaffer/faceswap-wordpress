<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
{% if error is defined and error %}
    <div class="error">{{ error }}</div>
{% endif %}
{% if baseImages is defined and faceImage is defined %}{% set baseImagesLength = baseImages|length %}
<div class="uploaded-images">
    <div class="face-image">
        <img src="data:image/jpeg;base64, {{ faceImage }}" />
    </div>
    <div class="base-images">
    <div class="row">
    {% for baseImage in baseImages %}
        <div class="base-image">
            <div class="image-crop">
                <img src="data:image/jpeg;base64, {{ baseImage }}" />
            </div>
            <script type="text/javascript">
            var request = $.ajax({
                url: '{{ serviceUrl }}',
                method: "POST",
                data: JSON.stringify({
                    image1: $('.base-image img:eq({{loop.index-1}})').attr('src').split(',')[1],
                    image2: $('.face-image img').attr('src').split(',')[1]
                }),
                headers: {'content-type': 'application/json'}
            });
            request.done(function(result) {
                $('.result-images .result-image-{{loop.index}}').html(
                    '<img src="data:image/jpeg;base64, ' + result + '" />'
                );
            });
            request.fail(function(jqXHR, textStatus) {
                console.log('it didnt work :(');
                $('.error').append(textStatus);
            });
            </script>
        </div>
        {% if 0 == loop.index % cols and not loop.last %}
            </div><div class="row">
        {% endif %}
    {% endfor %}
    </div>
    </div>
</div>
<div class="result-images">
    <div class="row">
    {% for baseImage in baseImages %}
        <div class="image-crop result-image-{{loop.index}}">
            <svg class="spinner" width="25px" height="25px" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg"><circle class="path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle>
            </svg>
        </div>
        {% if 0 == loop.index % cols and not loop.last %}
            </div><div class="row">
        {% endif %}
    {% endfor %}
        </div>
    </div>
</div>
{% endif %}
<form class="faceswap-upload-form" action="" method="POST" enctype="multipart/form-data">
    <fieldset>
        <legend>Image Uploads</legend>
        {{ form_widget(form) }}
    </fieldset>
    <input type="submit" value="Upload" />
</form>
<style>
svg {
    display:block;
    margin:auto;
    margin-top:25%;
}
.error {
    background-color: #dc3232;
    color: white;
    padding: 10px;
    margin-bottom: 10px;
}
.image-crop {
    overflow: hidden;
    float:left;
}
.image-crop img {
    overflow: hidden;
    float:left;
    height: auto;
    vertical-align: middle;
    display: inline-block;
    margin-left:50%;
    margin-top:50%;
    -webkit-transform:translateY(-50%) translateX(-50%);
    transform:translateY(-50%) translateX(-50%);
}
.face-image {
    float:left;
    width:440px;
    margin-right: 20px;
}
.base-images {
    float:left;
    width:440px;
    margin-top: -24px;
}
.result-images {
    margin-top:40px;
    width:906px;
    float:left;
}
{% if baseImagesLength is defined and baseImagesLength != 0 %}
.base-images .image-crop {
    width: {{ 440/cols }}px;
    height: {{ 440/cols }}px;
}
.base-images img {
    width: {{ 440/cols }}px;
}
.result-images .image-crop {
    width: {{ 900/cols }}px;
    height: {{ 900/cols }}px;
}
.result-images img {
    width: {{ 900/cols }}px;
}
{% endif %}
.home .entry-header {
    display:none;
}
.entry-content {
    width:100% !important;
}
.faceswap-upload-form {
    clear:left;
}
table, caption, tbody, tfoot, thead, tr, th, td {
    margin: 0;
    padding: 0;
    border: 0;
    outline: 0;
    font-size: 100%;
    vertical-align: baseline;
    background: transparent;
}
.spinner {
  -webkit-animation: rotator 1.4s linear infinite;
          animation: rotator 1.4s linear infinite;
}
@-webkit-keyframes rotator {
  0% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(270deg);
            transform: rotate(270deg);
  }
}

@keyframes rotator {
  0% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(270deg);
            transform: rotate(270deg);
  }
}
.path {
  stroke-dasharray: 187;
  stroke-dashoffset: 0;
  -webkit-transform-origin: center;
          transform-origin: center;
  -webkit-animation: dash 1.4s ease-in-out infinite, colors 5.6s ease-in-out infinite;
          animation: dash 1.4s ease-in-out infinite, colors 5.6s ease-in-out infinite;
}
@-webkit-keyframes colors {
  0% {
    stroke: #4285F4;
  }
  25% {
    stroke: #DE3E35;
  }
  50% {
    stroke: #F7C223;
  }
  75% {
    stroke: #1B9A59;
  }
  100% {
    stroke: #4285F4;
  }
}
@keyframes colors {
  0% {
    stroke: #4285F4;
  }
  25% {
    stroke: #DE3E35;
  }
  50% {
    stroke: #F7C223;
  }
  75% {
    stroke: #1B9A59;
  }
  100% {
    stroke: #4285F4;
  }
}
@-webkit-keyframes dash {
  0% {
    stroke-dashoffset: 187;
  }
  50% {
    stroke-dashoffset: 46.75;
    -webkit-transform: rotate(135deg);
            transform: rotate(135deg);
  }
  100% {
    stroke-dashoffset: 187;
    -webkit-transform: rotate(450deg);
            transform: rotate(450deg);
  }
}
@keyframes dash {
  0% {
    stroke-dashoffset: 187;
  }
  50% {
    stroke-dashoffset: 46.75;
    -webkit-transform: rotate(135deg);
            transform: rotate(135deg);
  }
  100% {
    stroke-dashoffset: 187;
    -webkit-transform: rotate(450deg);
            transform: rotate(450deg);
  }
}
</style>